
<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.png">
      
      <meta name="generator" content="mkdocs-0.16.3, mkdocs-material-1.10.1">
    
    
      
        <title>Tooling - Hollow (Netflix OSS)</title>
      
    
    
      <script src="../assets/javascripts/modernizr-e826f8942a.js"></script>
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-a20f419c8e.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-23f75ab9c7.palette.css">
      
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="red" data-md-color-accent="brown">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Hollow (Netflix OSS)" class="md-header-nav__button md-logo">
          
            <i class="md-icon md-icon--home"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Tooling
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" required placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset">&#xE5CD;</button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result" data-md-lang-search="" data-md-lang-tokenizer="[\s\-]+">
          <div class="md-search-result__meta" data-md-lang-result-none="No matching documents" data-md-lang-result-one="1 matching document" data-md-lang-result-other="# matching documents">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://github.com/Netflix/hollow" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <div class="md-nav__button md-logo">
      
        <i class="md-icon md-icon--home"></i>
      
    </div>
    Hollow (Netflix OSS)
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://github.com/Netflix/hollow" title="Go to repository" class="md-source" data-md-source="github">
    
      <div class="md-source__icon">
        <svg viewBox="0 0 24 24" width="24" height="24">
          <use xlink:href="#github" width="24" height="24"></use>
        </svg>
      </div>
    
    <div class="md-source__repository">
      GitHub
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../quick-start/" title="Quick Start" class="md-nav__link">
      Quick Start
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started/" title="Getting Started" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../indexing-querying/" title="Indexing/Querying" class="md-nav__link">
      Indexing/Querying
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../infrastructure/" title="Infrastructure Hooks" class="md-nav__link">
      Infrastructure Hooks
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../producer-consumer-apis/" title="Producers and Consumers" class="md-nav__link">
      Producers and Consumers
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Tooling
      </label>
    
    <a href="./" title="Tooling" class="md-nav__link md-nav__link--active">
      Tooling
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hollow-explorer" title="Hollow Explorer" class="md-nav__link">
    Hollow Explorer
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explorer-setup" title="Explorer Setup" class="md-nav__link">
    Explorer Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explorer-usage" title="Explorer Usage" class="md-nav__link">
    Explorer Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#history-tool" title="History tool" class="md-nav__link">
    History tool
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#history-setup" title="History Setup" class="md-nav__link">
    History Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#history-usage" title="History Usage" class="md-nav__link">
    History Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diff-tool" title="Diff Tool" class="md-nav__link">
    Diff Tool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heap-usage-analysis" title="Heap Usage Analysis" class="md-nav__link">
    Heap Usage Analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-tracking" title="Usage Tracking" class="md-nav__link">
    Usage Tracking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transitive-set-traverser" title="Transitive Set Traverser" class="md-nav__link">
    Transitive Set Traverser
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-manipulation-tools" title="Dataset Manipulation Tools" class="md-nav__link">
    Dataset Manipulation Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtering" title="Filtering" class="md-nav__link">
    Filtering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining" title="Combining" class="md-nav__link">
    Combining
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting" title="Splitting" class="md-nav__link">
    Splitting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-manipulation-tools" title="State Manipulation Tools" class="md-nav__link">
    State Manipulation Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patching" title="Patching" class="md-nav__link">
    Patching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../data-modeling/" title="Data Modeling" class="md-nav__link">
      Data Modeling
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../diving-deeper/" title="Diving Deeper" class="md-nav__link">
      Diving Deeper
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../interacting-with-a-dataset/" title="Interacting with a Hollow Dataset" class="md-nav__link">
      Interacting with a Hollow Dataset
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../data-ingestion/" title="Data Ingestion" class="md-nav__link">
      Data Ingestion
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../advanced-topics/" title="Advanced Topics" class="md-nav__link">
      Advanced Topics
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../glossary/" title="Glossary" class="md-nav__link">
      Glossary
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../community/" title="Community" class="md-nav__link">
      Community
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../acknowledgements/" title="Acknowledgements" class="md-nav__link">
      Acknowledgements
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hollow-explorer" title="Hollow Explorer" class="md-nav__link">
    Hollow Explorer
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#explorer-setup" title="Explorer Setup" class="md-nav__link">
    Explorer Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#explorer-usage" title="Explorer Usage" class="md-nav__link">
    Explorer Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#history-tool" title="History tool" class="md-nav__link">
    History tool
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#history-setup" title="History Setup" class="md-nav__link">
    History Setup
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#history-usage" title="History Usage" class="md-nav__link">
    History Usage
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#diff-tool" title="Diff Tool" class="md-nav__link">
    Diff Tool
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#heap-usage-analysis" title="Heap Usage Analysis" class="md-nav__link">
    Heap Usage Analysis
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#usage-tracking" title="Usage Tracking" class="md-nav__link">
    Usage Tracking
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#transitive-set-traverser" title="Transitive Set Traverser" class="md-nav__link">
    Transitive Set Traverser
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#dataset-manipulation-tools" title="Dataset Manipulation Tools" class="md-nav__link">
    Dataset Manipulation Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#filtering" title="Filtering" class="md-nav__link">
    Filtering
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#combining" title="Combining" class="md-nav__link">
    Combining
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#splitting" title="Splitting" class="md-nav__link">
    Splitting
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#state-manipulation-tools" title="State Manipulation Tools" class="md-nav__link">
    State Manipulation Tools
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#patching" title="Patching" class="md-nav__link">
    Patching
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/Netflix/hollow/edit/master/docs/tooling.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="insight-tools">Insight Tools</h1>
<p>Once your data is Hollow, you will be able to gain better insights into it.  Hollow ships with a number of useful tools for quickly gaining insights into your data, from broad patterns at high level, to zooming in to find and inspect specific individual records.</p>
<h2 id="hollow-explorer">Hollow Explorer</h2>
<p>Hollow ships with a UI which can be used to browse and search records within any dataset.</p>
<h3 id="explorer-setup">Explorer Setup</h3>
<p>The <code>HollowExplorerUI</code> class in the <em>hollow-explorer-ui</em> project is instantiated using either a <code>HollowReadStateEngine</code> or a <a href="../producer-consumer-apis/#the-hollowconsumer"><code>HollowConsumer</code></a> and a base URL path:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="c1">/// or your HollowReadStateEngine</span>

<span class="n">HollowExplorerUI</span> <span class="n">ui</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowExplorerUI</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="n">consumer</span><span class="o">);</span>
</pre></div>


<p>Incoming requests should be sent to the <code>handle</code> method in your <code>HollowExplorerUI</code> instance:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">String</span> <span class="n">target</span><span class="o">,</span>
                      <span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span>
                      <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span>
</pre></div>


<p>The <code>HollowExplorerUI</code> can be used in the context of an existing web container as shown above, <em>or</em> can be invoked via the included <code>HollowExplorerUIServer</code>, which uses the Jetty HTTP Servlet Server:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="c1">/// or your HollowReadStateEngine</span>

<span class="n">HollowExplorerUIServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowExplorerUIServer</span><span class="o">(</span><span class="n">consumer</span><span class="o">,</span> <span class="mi">8080</span><span class="o">);</span>

<span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="n">server</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
</pre></div>


<p>The above call to <code>server.join()</code> will block forever.  While the above code is running, you can point a browser to <em>http://localhost:8080</em> to explore your data.</p>
<div class="admonition warning">
<p class="admonition-title">Jetty: Optional Dependency</p>
<p>If using the <code>HollowExplorerUIServer</code>, you'll need to include a dependency on Jetty.  For example, with a Gradle build you may add the dependency:</p>
<p><code>compile 'org.eclipse.jetty:jetty-server:9.4.3.v20170317'</code></p>
</div>
<h3 id="explorer-usage">Explorer Usage</h3>
<p>Upon opening your browser, you should see something like this:</p>
<p><img alt="Explorer Home" src="../img/explorer-home.png" /></p>
<p>Click on a column header to sort by that column.  This view shows details about how many records exist for each type, and the approximate heap footprint of each type.</p>
<p>Click on a type to browse records.  We'll arrive at a screen like the following:</p>
<p><img alt="Explorer Browse Type" src="../img/explorer-browsetype.png" /></p>
<p>Clicking on the record keys on the left will display the corresponding record contents in the display field.  </p>
<p>Now imagine we wanted to search for movies in which Carrie-Anne Moss starred.  On this page, click the <strong>Browse Schema</strong> link in the header to arrive at the following page:</p>
<p><img alt="Explorer Browse Schema" src="../img/explorer-browseschema.png" /></p>
<p>The view on this page is a collapsible tree-view of the current type's <em>schema</em>.  Each searchable field in this view will contain a <strong>search</strong> link, which will prepopulate the <em>search</em> page with the type and field name.  We can navigate to the <code>Actor.actorName</code> field and click <strong>search</strong>.  We will arrive on the <em>search</em> page with the type and field name prepopulated:</p>
<p><img alt="Explorer Query" src="../img/explorer-searchquery.png" /></p>
<p>We can enter the field value we are looking for and click <strong>Submit</strong>, and we will see the number of matching records of each type.  Search query matches are not limited to the directly matching records -- they are automatically rolled up to include any referencing records as well:</p>
<p><img alt="Explorer Search Results" src="../img/explorer-searchresult.png" /></p>
<p>If we click on the type <strong>Movie</strong> on this page, we'll be presented with the browse view again, but this time filtered to matching records:</p>
<p><img alt="Explorer Browse Search Results" src="../img/explorer-browsesearchresult.png" /></p>
<p>Search queries remain active in the browser session until cleared, and can be augmented to find the intersection of matches over multiple fields by entering multiple query parameters without clearing the existing ones in the session.  For example, if we want to find movies in which <em>both</em> Carrie-Anne Moss and the Actor with ID <code>1001</code> starred, we can go back to the search page, and enter the appropriate criteria to augment our session's query.  The results will contain only records which match <em>both</em> of these criteria:</p>
<p><img alt="Explorer Augment Query" src="../img/explorer-augmentsearchresult.png" /></p>
<h2 id="history-tool">History tool</h2>
<p>Hollow ships with a UI which can be used to browse and search changes in a dataset over time.  The history tool provides the ability to get a bird’s eye view of all of the changes a dataset goes through over time, while simultaneously allowing for specific queries to see exactly how individual records change as the dataset transitions between states.  The history tool has proven to be enormously beneficial when investigating data issues in production scenarios.  When something looks incorrect, it’s easy to pinpoint exactly what changed when, which can vastly expedite data corrections and eliminate hours of potential detective work.</p>
<h3 id="history-setup">History Setup</h3>
<p>The <code>HollowHistoryUI</code> class in the <em>hollow-diff-ui</em> project can be instantiated using a <code>HollowConsumer</code> and a base URL path:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="c1">/// or your HollowReadStateEngine</span>

<span class="n">HollowHistoryUI</span> <span class="n">ui</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowHistoryUI</span><span class="o">(</span><span class="s">&quot;&quot;</span><span class="o">,</span> <span class="n">consumer</span><span class="o">);</span>
</pre></div>


<p>The <code>HollowHistoryUI</code> will by default be configured to track all of the types for which primary keys have been specified.  By default, it will track changes through the latest rolling 1024 states.  This default can be changed with another parameter in the constructor.</p>
<p>Incoming requests should be sent to the <code>handle</code> method in your <code>HollowExplorerUI</code> instance:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">handle</span><span class="o">(</span><span class="n">String</span> <span class="n">target</span><span class="o">,</span>
                      <span class="n">HttpServletRequest</span> <span class="n">req</span><span class="o">,</span>
                      <span class="n">HttpServletResponse</span> <span class="n">resp</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">IOException</span>
</pre></div>


<p>The <code>HollowHistoryUI</code> can be used in the context of an existing web container as shown above, <em>or</em> can be invoked via the included <code>HollowHistoryUIServer</code>, which uses the Jetty HTTP Servlet Server:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="o">...</span>

<span class="n">HollowHistoryUIServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowHistoryUIServer</span><span class="o">(</span><span class="n">consumer</span><span class="o">,</span> <span class="mi">8080</span><span class="o">);</span>

<span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>
<span class="n">server</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
</pre></div>


<p>The above call to <code>server.join()</code> will block forever.  While the above code is running, you can point a browser to <em>http://localhost:8080</em> to explore the history.</p>
<h3 id="history-usage">History Usage</h3>
<p>Upon opening your browser, you will see something like this:</p>
<p><img alt="History Home" src="../img/history-home.png" /></p>
<p>The history UI will track changes in types for which you have defined primary keys.  In this view, we're looking at the number of records which changed between <em>data states</em>.  The changes in each state are broken down here into <em>modifications</em>, <em>additions</em>, and <em>removals</em>.  Clicking on a state will show us a further breakdown of these changes by each top-level type:</p>
<p><img alt="History State View" src="../img/history-state.png" /></p>
<p>Clicking on a type will show us the individual records which changed:</p>
<p><img alt="History State Type View" src="../img/history-statetype.png" /></p>
<p>If we click on one of these records, we'll be able to inspect precisely what happened:</p>
<p><img alt="History Object View" src="../img/history-objectview.png" /></p>
<p>This is a collapsible tree-view in which the entire before/after state of the record is available, but only the differences are expanded by default.  Click on individual field names to expand/collapse them.</p>
<div class="admonition note">
<p class="admonition-title">Partially Expanded</p>
<p>The double-arrows in the example above mean the field is <em>partially expanded</em> to highlight the diffs.  Clicking on it will fully expand the field.</p>
</div>
<p>Removals show up as red, additions as green, and modifications as yellow.  The following example shows a modified actor name:</p>
<p><img alt="History Object View 2" src="../img/history-objectview2.png" /></p>
<p>If this specific record key has changed in multiple states tracked by this history, those states will be highlighted on the left.  We can click back and forth through the changes to see how this record evolved over time.</p>
<p>We can also search for changes in specific records by their keys.  On each page in the history tool, a textbox is available in the header labeled <strong>Lookup</strong>.   Plugging in <em>a single field</em> of a key of any type into this field will find matching diffs through the history:</p>
<p><img alt="History Lookup" src="../img/history-lookup.png" /></p>
<p>Clicking on individual records will bring us back to the object diff view page to see what was changed.</p>
<h2 id="diff-tool">Diff Tool</h2>
<p>Just as the Hollow history tool UI makes the differences between any two <em>adjacent</em> states in a delta chain readily accessible, the Hollow diff tool is used to investigate the differences between any two <em>arbitrary</em> data states, even those which may exist in different delta chains.</p>
<p>This is especially useful as a step in a regular release cadence, as the differences between data states produced, for example, in a test environment and production environment can be evaluated at a glance.  Sometimes, unintended consequences of code updates may be discovered this way, which prevents production issues before they happen.</p>
<p>Initiating a diff between two data states is accomplished by loading both states into separate <code>HollowReadStateEngines</code> in memory, and then instantiating a <code>HollowDiff</code> and configuring it with the primary keys of types to diff.  For our <code>Movie</code>/<code>Actor</code> example:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowConsumer</span> <span class="n">testConsumer</span> <span class="o">=</span> <span class="c1">/// load the test data</span>
<span class="n">HollowConsumer</span> <span class="n">prodConsumer</span> <span class="o">=</span> <span class="c1">/// load the prod data</span>

<span class="n">HollowReadStateEngine</span> <span class="n">testData</span> <span class="o">=</span> <span class="n">testConsumer</span><span class="o">.</span><span class="na">getStateEngine</span><span class="o">();</span>
<span class="n">HollowReadStateEngine</span> <span class="n">prodData</span> <span class="o">=</span> <span class="n">prodConsumer</span><span class="o">.</span><span class="na">getStateEngine</span><span class="o">();</span>

<span class="n">HollowDiff</span> <span class="n">diff</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowDiff</span><span class="o">(</span><span class="n">testData</span><span class="o">,</span> <span class="n">prodData</span><span class="o">);</span>
<span class="n">diff</span><span class="o">.</span><span class="na">addTypeDiff</span><span class="o">(</span><span class="s">&quot;Movie&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">);</span>
<span class="n">diff</span><span class="o">.</span><span class="na">addTypeDiff</span><span class="o">(</span><span class="s">&quot;Actor&quot;</span><span class="o">,</span> <span class="s">&quot;actorId&quot;</span><span class="o">);</span>

<span class="n">diff</span><span class="o">.</span><span class="na">calculateDiffs</span><span class="o">();</span>
</pre></div>


<p>A diff is calculated by matching records of the same type based on defined primary keys.  The unmatched records in both states are tracked, and detailed differences between field values in matching pairs are also tracked.</p>
<div class="admonition hint">
<p class="admonition-title">Primary Keys</p>
<p>The <code>HollowDiff</code> will, by default, automatically configure any primary keys which are defined in the <code>Object</code> schemas of your dataset.</p>
</div>
<p>Hollow includes a ready-made UI which can be applied to a <code>HollowDiff</code>.    The <code>HollowDiffUI</code> class can be used in the context of an existing web container, or can be invoked via the <code>HollowDiffUIServer</code>, which uses the Jetty HTTP Servlet Server:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowDiff</span> <span class="n">diff</span> <span class="o">=</span> <span class="c1">/// build the diff</span>

<span class="n">HollowDiffUIServer</span> <span class="n">server</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowDiffUIServer</span><span class="o">(</span><span class="mi">8080</span><span class="o">);</span>
<span class="n">server</span><span class="o">.</span><span class="na">start</span><span class="o">();</span>

<span class="n">server</span><span class="o">.</span><span class="na">addDiff</span><span class="o">(</span><span class="s">&quot;diff&quot;</span><span class="o">,</span> <span class="n">diff</span><span class="o">);</span>

<span class="n">server</span><span class="o">.</span><span class="na">join</span><span class="o">();</span>
</pre></div>


<p>While the above code is running, you can point a browser to <em>http://localhost:8080</em> to explore the diff.</p>
<h2 id="heap-usage-analysis">Heap Usage Analysis</h2>
<p>One of the most important considerations when dealing with in-memory datasets is the heap utilization of that dataset on consumer machines.  Hollow provides a number of methods to analyze this metric.</p>
<p>Given a loaded <code>HollowReadStateEngine</code>, it is possible to iterate over each type and gather statistics about its approximate heap usage.  This is done in the following example:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowReadStateEngine</span> <span class="n">stateEngine</span> <span class="o">=</span> <span class="c1">/// a populated state engine</span>

<span class="kt">long</span> <span class="n">totalApproximateHeapFootprint</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>

<span class="k">for</span><span class="o">(</span><span class="n">HollowTypeReadState</span> <span class="n">typeState</span> <span class="o">:</span> <span class="n">stateEngine</span><span class="o">.</span><span class="na">getTypeStates</span><span class="o">())</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">typeName</span> <span class="o">=</span> <span class="n">typeState</span><span class="o">.</span><span class="na">getSchema</span><span class="o">().</span><span class="na">getName</span><span class="o">();</span>
    <span class="kt">long</span> <span class="n">heapCost</span> <span class="o">=</span> <span class="n">typeState</span><span class="o">.</span><span class="na">getApproximateHeapFootprintInBytes</span><span class="o">();</span>
    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">typeName</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span> <span class="n">heapCost</span><span class="o">);</span>
    <span class="n">totalApproximateHeapFootprint</span> <span class="o">+=</span> <span class="n">heapCost</span><span class="o">;</span>
<span class="o">}</span>

<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;TOTAL: &quot;</span> <span class="o">+</span> <span class="n">totalApproximateHeapFootprint</span><span class="o">);</span>
</pre></div>


<p>As shown above, information can be gathered about the total heap footprint, and also about the heap footprint of individual types.  This information can be helpful in identifying optimization targets.  This technique can also be used to identify how the heap cost of individual types changes over time, which can provide early warning signs about optimizations which should be targeted proactively.</p>
<h2 id="usage-tracking">Usage Tracking</h2>
<p>Hollow tracks usage, which can be investigated at runtime.  By default, this functionality is turned off, but it can be enabled by injecting a HollowSamplingDirector into a Hollow API in a running instance.  You can use the TimeSliceSamplingDirector implementation, which will by default record every access which happens during 1ms out of every second:</p>
<div class="codehilite"><pre><span></span><span class="n">MovieAPI</span> <span class="n">api</span> <span class="o">=</span> <span class="c1">/// a custom-generated API</span>

<span class="n">TimeSliceSamplingDirector</span> <span class="n">samplingDirector</span> <span class="o">=</span> <span class="k">new</span> <span class="n">TimeSliceSamplingDirector</span><span class="o">();</span>
<span class="n">samplingDirector</span><span class="o">.</span><span class="na">startSampling</span><span class="o">();</span>

<span class="n">api</span><span class="o">.</span><span class="na">setSamplingDirector</span><span class="o">(</span><span class="n">samplingDirector</span><span class="o">);</span>
</pre></div>


<p>Once this is enabled, and some time has passed for samples to be gathered, the results can be collected for analysis:</p>
<div class="codehilite"><pre><span></span><span class="k">for</span><span class="o">(</span><span class="n">SampleResult</span> <span class="n">result</span> <span class="o">:</span> <span class="n">api</span><span class="o">.</span><span class="na">getAccessSampleResults</span><span class="o">())</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getNumSamples</span><span class="o">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">)</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">result</span><span class="o">.</span><span class="na">getIdentifier</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;: &quot;</span> <span class="o">+</span>
                                                  <span class="n">result</span><span class="o">.</span><span class="na">getNumSamples</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>


<h2 id="transitive-set-traverser">Transitive Set Traverser</h2>
<p>The <code>TransitiveSetTraverser</code> can be used to find children and parent references for a selected set of records.  We start with an initial set of selected records by ordinal, represented with a <code>Map&lt;String, BitSet&gt;</code>.  Entries in this map will indicate a type, plus the ordinals of the selected records:</p>
<div class="codehilite"><pre><span></span><span class="n">Map</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">BitSet</span><span class="o">&gt;</span> <span class="n">selection</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">BitSet</span><span class="o">&gt;();</span>

<span class="c1">/// select the movies with IDs 1 and 6.</span>
<span class="n">BitSet</span> <span class="n">selectedMovies</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BitSet</span><span class="o">();</span>
<span class="n">selectedMovies</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">movieIdx</span><span class="o">.</span><span class="na">getMatchingOrdinal</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
<span class="n">selectedMovies</span><span class="o">.</span><span class="na">set</span><span class="o">(</span><span class="n">movieIdx</span><span class="o">.</span><span class="na">getMatchingOrdinal</span><span class="o">(</span><span class="mi">6</span><span class="o">));</span>

<span class="n">selection</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;Movie&quot;</span><span class="o">,</span> <span class="n">movies</span><span class="o">);</span>
</pre></div>


<p>We can add the references, and the <em>transitive references</em> of our selection.  After the following call returns, our selection will be augmented with these matches:</p>
<div class="codehilite"><pre><span></span><span class="n">TransitiveSetTraverser</span><span class="o">.</span><span class="na">addTransitiveMatches</span><span class="o">(</span><span class="n">readEngine</span><span class="o">,</span> <span class="n">selection</span><span class="o">);</span>
</pre></div>


<div class="admonition note">
<p class="admonition-title">Transitive References</p>
<p>If A references B, and B references C, then A transitively references C</p>
</div>
<p>Given a selection, we can also add any records which reference anything in the selection.  This is essentially the opposite operation as above; it can be said that <code>addTransitiveMatches</code> traverses down, while <code>addReferencingOutsideClosure</code> traverses up.  After the following call returns, our selection will be augmented with this selection:</p>
<div class="codehilite"><pre><span></span><span class="n">TransitiveSetTraverser</span><span class="o">.</span><span class="na">removedReferencedOutsideClosure</span><span class="o">(</span><span class="n">readEngine</span><span class="o">,</span> <span class="n">selection</span><span class="o">);</span>
</pre></div>


<h2 id="dataset-manipulation-tools">Dataset Manipulation Tools</h2>
<h3 id="filtering">Filtering</h3>
<p>Sometimes, a dataset will be of interest to multiple different types of consumers, but not all consumers may be interested in all aspects of a dataset.  In these cases, it’s possible to omit certain types and fields from a client’s view of the data.  This is typically done to tailor a consumer’s heap footprint and startup time costs based on their data needs.</p>
<p>Using our <code>Movie</code>/<code>Actor</code> example above, if there was a consumer which was interested in <code>Movie</code> records, but not <code>Actor</code> records, that consumer might construct a consumer-side data filter configuration in the following way:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowFilterConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowFilterConfig</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">&quot;Movie&quot;</span><span class="o">,</span> <span class="s">&quot;actors&quot;</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">addType</span><span class="o">(</span><span class="s">&quot;ListOfActor&quot;</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">addType</span><span class="o">(</span><span class="s">&quot;Actor&quot;</span><span class="o">);</span>
</pre></div>


<p>The boolean <code>true</code> parameter in the constructor above indicates that this is an exclusion filter.  We could accomplish the same goal using an inclusion filter:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowFilterConfig</span> <span class="n">config</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowFilterConfig</span><span class="o">(</span><span class="kc">false</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">&quot;Movie&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">&quot;Movie&quot;</span><span class="o">,</span> <span class="s">&quot;title&quot;</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">addField</span><span class="o">(</span><span class="s">&quot;Movie&quot;</span><span class="o">,</span> <span class="s">&quot;releaseYear&quot;</span><span class="o">);</span>
<span class="n">config</span><span class="o">.</span><span class="na">addType</span><span class="o">(</span><span class="s">&quot;String&quot;</span><span class="o">);</span>
</pre></div>


<p>The difference between these two configurations is how the filter behaves as new types and fields are added to the data model.  The exclusion filter will not exclude them by default, whereas the inclusion filter will.</p>
<p>A filter configuration is applied to a <code>HollowConsumer</code> at read time:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowConsumer</span> <span class="n">consumer</span> <span class="o">=</span> <span class="n">HollowConsumer</span><span class="o">.</span><span class="na">withBlobReader</span><span class="o">(</span><span class="n">reader</span><span class="o">)</span>
                                        <span class="o">.</span><span class="na">withFilterConfig</span><span class="o">(</span><span class="n">config</span><span class="o">)</span>
                                        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</pre></div>


<h3 id="combining">Combining</h3>
<p>The <code>HollowCombiner</code> is used to copy data from one or more copies of hollow datasets in <code>HollowReadStateEngine</code>s into a single <code>HollowWriteStateEngine</code>.  If each of the inputs contain the same data model, the following is sufficient to combine them:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowReadStateEngine</span> <span class="n">input1</span> <span class="o">=</span> <span class="c1">/// an input</span>
<span class="n">HollowReadStateEngine</span> <span class="n">input2</span> <span class="o">=</span> <span class="c1">/// another input</span>

<span class="n">HollowCombiner</span> <span class="n">combiner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowCombiner</span><span class="o">(</span><span class="n">input1</span><span class="o">,</span> <span class="n">input2</span><span class="o">);</span>
<span class="n">combiner</span><span class="o">.</span><span class="na">combine</span><span class="o">();</span>

<span class="n">HollowWriteStateEngine</span> <span class="n">combined</span> <span class="o">=</span> <span class="n">combiner</span><span class="o">.</span><span class="na">getCombinedStateEngine</span><span class="o">();</span>
</pre></div>


<p>By default, the combiner will copy all records from all types from the inputs to the output.  We can direct the combiner to exclude certain records from copying using a <code>HollowCombinerCopyDirector</code>.  The interface for a <code>HollowCombinerCopyDirector</code> allows for making decisions about copying individual records during a combine operation by implementing the following method:</p>
<div class="codehilite"><pre><span></span><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">shouldCopy</span><span class="o">(</span><span class="n">HollowTypeReadState</span> <span class="n">typeState</span><span class="o">,</span> <span class="kt">int</span> <span class="n">ordinal</span><span class="o">);</span>
</pre></div>


<p>If this method returns false, then the copier will not attempt to directly copy the matching record.  However, if the matching record is referenced via another record for which this method returns true, then it will still be copied regardless of the return value of this method.</p>
<p>The most broadly useful provided implementation of the <code>HollowCombinerCopyDirector</code> is the <code>HollowCombinerExcludePrimaryKeysCopyDirector</code>, which can be used to specify record exclusions by primary key.  For example, if we wanted to create a copy of a state engine with the <code>Movie</code> records with ids 100 and 125 excluded:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowReadStateEngine</span> <span class="n">input</span> <span class="o">=</span> <span class="c1">/// an input</span>
<span class="n">HollowPrimaryKeyIndex</span> <span class="n">idx</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowPrimaryKeyIndex</span><span class="o">(</span><span class="n">input</span><span class="o">,</span> <span class="s">&quot;Movie&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">);</span>

<span class="n">HollowCombinerExcludePrimaryKeysCopyDirector</span> <span class="n">director</span> <span class="o">=</span>
                          <span class="k">new</span> <span class="n">HollowCombinerExcludePrimaryKeysCopyDirector</span><span class="o">();</span>

<span class="n">director</span><span class="o">.</span><span class="na">excludeKey</span><span class="o">(</span><span class="n">idx</span><span class="o">,</span> <span class="mi">100</span><span class="o">);</span>
<span class="n">director</span><span class="o">.</span><span class="na">excludeKey</span><span class="o">(</span><span class="n">idx</span><span class="o">,</span> <span class="mi">125</span><span class="o">);</span>

<span class="n">HollowCombiner</span> <span class="n">combiner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowCombiner</span><span class="o">(</span><span class="n">director</span><span class="o">,</span> <span class="n">input</span><span class="o">);</span>
<span class="n">combiner</span><span class="o">.</span><span class="na">combine</span><span class="o">();</span>

<span class="n">HollowWriteStateEngine</span> <span class="n">result</span> <span class="o">=</span> <span class="n">combiner</span><span class="o">.</span><span class="na">getCombineStateEngine</span><span class="o">();</span>
</pre></div>


<p>It’s possible that while combining two inputs, both may have a record of the same type with the same primary key.  This violation of the uniqueness constraint of a primary key can be avoided by informing the combiner of the primary keys in a data model prior to the combine operation:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowCombiner</span> <span class="n">combiner</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowCombiner</span><span class="o">(</span><span class="n">input1</span><span class="o">,</span> <span class="n">input2</span><span class="o">);</span>

<span class="n">combiner</span><span class="o">.</span><span class="na">setPrimaryKeys</span><span class="o">(</span>
        <span class="k">new</span> <span class="n">PrimaryKey</span><span class="o">(</span><span class="s">&quot;Movie&quot;</span><span class="o">,</span> <span class="s">&quot;id&quot;</span><span class="o">),</span>
        <span class="k">new</span> <span class="n">PrimaryKey</span><span class="o">(</span><span class="s">&quot;Actor&quot;</span><span class="o">,</span> <span class="s">&quot;actorId&quot;</span><span class="o">)</span>
<span class="o">);</span>

<span class="n">combiner</span><span class="o">.</span><span class="na">combine</span><span class="o">();</span>
</pre></div>


<p>If multiple records exist in the inputs matching a single value for any of the supplied primary keys, then only one such record will be copied to the output.  The specific record which is copied will be the record from the input was supplied earliest in the constructor of the <code>HollowCombiner</code>.  Further, if any record references another record which was omitted because it would have been duplicate based on this rule, then that reference is remapped in the output state to the matching record which was chosen to be included.</p>
<h3 id="splitting">Splitting</h3>
<p>A single dataset can be sharded into multiple datasets using a <code>HollowSplitter</code>.  The <code>HollowSplitter</code> takes a <code>HollowSplitterCopyDirector</code>, which indicates:</p>
<ul>
<li><em>top level</em> types to split,</li>
<li>the number of shards to create, and</li>
<li>which shard to send individual records.</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Top Level Types</p>
<p>Top level types are those which are not referenced by any other types.  In our <code>Movie</code>/<code>Actor</code> example, <code>Movie</code> is a top-level type, but <code>Actor</code> is not.</p>
</div>
<p>Two default implementations of <code>HollowSplitterCopyDirector</code> are available:</p>
<ul>
<li><code>HollowSplitterOrdinalCopyDirector</code></li>
<li><code>HollowSplitterPrimaryKeyCopyDirector</code>.  </li>
</ul>
<p>These directors will split top-level types among a specified number of shards either by ordinals or primary keys, respectively.  When splitting by ordinal, a record with a specific primary key may jump between shards when it is modified, while with the primary key director a specific primary key will consistently hash to the same shard.</p>
<p>Our <code>Movie</code>/<code>Actor</code> example may use the splitter to split a dataset into four shards with the following invocation:</p>
<div class="codehilite"><pre><span></span><span class="n">HollowReadStateEngine</span> <span class="n">stateEngine</span> <span class="o">=</span> <span class="c1">/// a state engine</span>

<span class="n">HollowSplitterCopyDirector</span> <span class="n">director</span> <span class="o">=</span>
                            <span class="k">new</span> <span class="n">HollowSplitterOrdinalCopyDirector</span><span class="o">(</span><span class="mi">4</span><span class="o">,</span> <span class="s">&quot;Movie&quot;</span><span class="o">);</span>

<span class="n">HollowSplitter</span> <span class="n">splitter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HollowSplitter</span><span class="o">(</span><span class="n">director</span><span class="o">,</span> <span class="n">stateEngine</span><span class="o">);</span>
<span class="n">splitter</span><span class="o">.</span><span class="na">split</span><span class="o">();</span>


<span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">4</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
    <span class="n">HollowWriteStateEngine</span> <span class="n">shard</span> <span class="o">=</span> <span class="n">splitter</span><span class="o">.</span><span class="na">getOutputShardStateEngine</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>


<h2 id="state-manipulation-tools">State Manipulation Tools</h2>
<h3 id="patching">Patching</h3>
<p>Using the <code>HollowWriteStateEngine</code>’s restore capability, it’s possible to produce deltas forever, so that consumers never have to load a snapshot after initialization.  However, if environmental hiccups cause a producer to fail to publish a delta, or if a delta is lost, or if it’s desired to publish a delta between non-adjacent states, then the <code>HollowStateDeltaPatcher</code> may be used to produce deltas between two arbitrary states within the same delta chain.</p>
<p>The <code>HollowStateDeltaPatcher</code> must produce <em>two</em> delta transitions to create a transition between arbitrary states.  This is because non-adjacent states may have different records occupying the same ordinals.  Since no ordinal may be removed and added in adjacent states, the state patcher must create an intermediate state in which modified records do not share any ordinals.</p>
<p>See the <code>HollowStateDeltaPatcher</code> javadocs for usage details.</p>
                
                  
                
              
              
                
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../producer-consumer-apis/" title="Producers and Consumers" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Producers and Consumers
              </span>
            </div>
          </a>
        
        
          <a href="../data-modeling/" title="Data Modeling" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Data Modeling
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://github.com/Netflix/hollow" class="md-footer-social__link fa fa-github"></a>
    
      <a href="https://gitter.im/Netflix/hollow" class="md-footer-social__link fa fa-gitter"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-f3ab9e5ff8.js"></script>
      
      
      <script>app.initialize({url:{base:".."}})</script>
      
    
    
      
    
  </body>
</html>